services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: meetbarter_backend
    restart: always
    ports:
      - '3001:3001'
    environment:
      DATABASE_URL: "file:../data/meetbarter.db"
      JWT_SECRET: ${JWT_SECRET:-super-secret-key-change-this}
      FRONTEND_URL: ${FRONTEND_URL:-http://localhost:3000}
      # Vault & Codes - Ensure these match your .env
      VAULT_KEY: ${VAULT_KEY}
      ADMIN_ALPHA_CODE: ${ADMIN_ALPHA_CODE}
      ADMIN_BETA_CODE: ${ADMIN_BETA_CODE}
      ADMIN_FINGERPRINT: ${ADMIN_FINGERPRINT}
    volumes:
      - ./data:/app/backend/data
      - ./data/vault:/app/backend/vault_storage
    depends_on: []

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: meetbarter_frontend
    restart: always
    ports:
      - '3000:3000'
    environment:
      NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-http://localhost:3001}
    depends_on:
      - backend

volumes:
  # Using local bind mounts in ./data instead of named volumes for easier backup

